---
title: Azure AD Service Principal with long expiry
description: How to create an Azure AD Service Principal with a long expiry
date: "2023-01-06"
authors:
  - tommy
---

<Callout>
  I use MacOS, so the commands below are for MacOS. If you are using Windows, you can use the Azure
  CLI in the Cloud Shell. Or follow instructions to [install the Azure CLI on
  Windows](https://learn.microsoft.com/en-us/cli/azure/install-azure-cli-windows?tabs=azure-cli).
</Callout>

Working with Azure AD Service Principals is a common task for developers working in a Azure environment. You can use them to authenticate to Azure resources, or to authenticate to other services that use Azure AD as an identity provider.
In my case i needed a client secret that would last for a long time, so I could use it for autentication via [NextAuth.js](https://next-auth.js.org/).

<Callout type="warning">
  You should always use a service principal with a short expiry, and rotate the secret regularly.
  This is just a workaround for development and test environment.
</Callout>

Azure only allows you to create a service principal with a maximum expiry of 2 years. If you need a longer expiry, you can use the Microsoft Graph API to create a service principal with a longer expiry.
In this post I will show you how to create client secret via the Azure CLI using the rest command.

## Login to the correct Azure subscription

I'm currently working on a project for a client and using Azure AD B2C for authentication. So I need to make sure I am logged in to the correct subscription.

```bash
az login -t {INPUT_YOUR_SUBSCRIPTION} --allow-no-subscriptions
```

## List all applications in Azure subscription

We need the correct application ID to create the service principal. You can find the application ID in the Azure Portal as `Object ID` under `Overview`, or you can list all applications in your subscription.

```bash
az rest \
--method GET \
--uri 'https://graph.microsoft.com/v1.0/{INPUT_YOUR_SUBSCRIPTION}/applications'
```

## Create a service principal

When we have our ID we can make a POST request to the addPassword endpoint for creating a new secret with a specific name and a expiry date of our choice.

```bash
az rest \
--method POST \
--headers "Content-Type=application/json" \
--uri 'https://graph.microsoft.com/v1.0/hansaborgb2ctest.onmicrosoft.com/applications/a8e4caac-cd97-4c67-861c-bbe7deda4f9b/addPassword' \
--body '{"passwordCredential":{"displayName":"fitting-password-name","endDateTime":"2222-12-31T00:00:00.000Z"}}'
```

Be sure to copy the `secretText` from the response, as you will not be able to retrieve it again.
